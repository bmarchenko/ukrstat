{% extends "base.html" %}
{% block title %}Підприємства  за регіонами у 2011 році{% endblock %}
{% block extra_js %}
    <script>
        // add all your code to this method, as this will ensure that page is loaded
        AmCharts.ready(function() {
            // create AmMap object
            map = new AmCharts.AmMap();
            // set path to images
            map.pathToImages = "ammap/images/";

            var dataProvider = {
                mapVar: AmCharts.maps.ukraineLow,
                getAreasFromMap:true
            };
            // pass data provider to the map object
            map.dataProvider = dataProvider;

            map.areasSettings = {
                autoZoom: true,
                selectedColor: "#CC0000"
            };

            // let's say we want a small map to be displayed, so let's create it
            map.smallMap = new AmCharts.SmallMap();

            // write the map to container div
            map.write("mapdiv");
            areas=map.dataProvider.areas

        });
    </script>


    <script type="text/javascript">
        var chartData = [{id:"UA_KR", country: "АР Крим", visits: 18.5 },
            {id:"UA_VI", country: "Вінницька", visits: 14.5 },
            {id:"UA_VO", country: "Волинська", visits: 15.8 },
            {id:"UA_DP", country: "Дніпропетровська", visits:  20.3 },
            {id:"UA_DT", country: "Донецька", visits: 17.7 },
            {id:"UA_ZT", country: "Житомирська", visits: 14.3 },
            {id:"UA_ZK", country: "Закарпатська", visits: 13.9 },
            {id:"UA_ZP", country: "Запорізька", visits: 20.5 },
            {id:"UA_IF", country: "Івано-Франківська", visits: 17.0 },
            {id:"UA_KV", country: "Київська", visits: 19.4 },
            {id:"UA_KH", country: "Кіровоградська", visits: 19.2 },
            {id:"UA_LH", country: "Луганська", visits: 13.7 },
            {id:"UA_LV", country: "Львівська", visits: 21.8 },
            {id:"UA_MY", country: "Миколаївська", visits: 16.5 },
            {id:"UA_OD", country: "Одеська", visits: 20.3 },
            {id:"UA_PL", country: "Полтавська", visits: 16.9 },
            {id:"UA_RV", country: "Рівненська", visits: 14.2},
            {id:"UA_SM", country: "Сумська", visits: 14.5},
            {id:"UA_TP", country: "Тернопільська", visits: 15.5},
            {id:"UA_KK", country: "Харківська", visits: 20.5},
            {id:"UA_KS", country: "Херсонська", visits: 16.8},
            {id:"UA_KM", country: "Хмельницька", visits: 11.7},
            {id:"UA_CK", country: "Черкаська", visits: 15.8},
            {id:"UA_CV", country: "Чернівецька", visits: 11.4},
            {id:"UA_CH", country: "Чернігівська", visits: 14.9},
            {id:"UA_KC", country: "м.Київ", visits: 46.3},
            {id:"UA_SC", country: "м.Севастополь", visits: 16.9}];


        window.onload = function () {
            function compare(a,b) {
                if (a.visits < b.visits)
                    return 1;
                if (a.visits > b.visits)
                    return -1;
                return 0;
            }
            chartData.sort(compare);
            chart = new AmCharts.AmSerialChart();
            chart.dataProvider = chartData;
            chart.categoryField = "country";
            chart.marginTop = 15;
            chart.marginLeft = 55;
            chart.marginRight = 15;
            chart.marginBottom = 80;
            chart.angle = 30;
            chart.depth3D = 15;
            var catAxis = chart.categoryAxis;
            catAxis.autoGridCount=false;
            catAxis.gridCount = chartData.length;
//            catAxis.startOnAxis = true;
            catAxis.labelRotation = 90;

//            chart.valueAxes[0].min = 0;


            var graph = new AmCharts.AmGraph();
            graph.balloonText = "[[category]]: [[value]]";
            graph.valueField = "visits"
            graph.type = "column";
            graph.lineAlpha = 0;
            graph.fillAlphas = 0.8;

            chart.addGraph(graph);

            chart.write('chartContainer');
            chart.addListener("rollOverGraphItem", function(a){id = a.item.dataContext.id;
                for(var i = 0, m = null; i < areas.length; ++i) {     if(areas[i].id != id)         continue;     m = areas[i];     break; }
                map.rollOverMapObject(m)})
            chart.addListener("clickGraphItem", function(a){id = a.item.dataContext.id;
                for(var i = 0, m = null; i < areas.length; ++i) {     if(areas[i].id != id)         continue;     m = areas[i];     break; }
                map.clickMapObject(m)
                console.log(a)})
//            map.addListener("clickMapObject", function(a){id = a.item.dataContext.id;
//                for(var i = 0, m = null; i < areas.length; ++i) {     if(areas[i].id != id)         continue;     m = areas[i];     break; }
////                map.clickMapObject(m)
//                console.log(a)})
        }

    </script>
{% endblock %}
{% block body %}
    <h1>Підприємства  за регіонами у 2011 році</h1>
    <div id="chartContainer" style="width: 640px; height: 400px; float: left"></div>
    <div id="mapdiv" style="width: 640px; height: 400px; float: right"></div>
{% endblock %}